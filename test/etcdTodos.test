// TODO: save_fsync latency?
// todo: fill in ClusterId
// todo: fill in MemberId:
// todo: fill in RaftTerm:
// TODO: use marshalTo to reduce allocation
// TODO: add timeout
// TODO: limit the rate of the error logging.
// TODO: limit the rate of the error logging.
// TODO: raft state machine version
// TODO: revert by revision and find specified hash value
// TODO: gather more informations
// TODO: memory usage, raft information, etc..
// TODO: add backoff option
// TODO: 10-second is enough timeout to cover leader failure
// TODO: Too intensive stressers can panic etcd member with
// TODO: set it to a reasonable value. It is set that high because
// TODO: add a.Desc() as a key of the map
// TODO: try to simplify this by introducing ID type into raft
// TODO(bdarnell): These entries are still unstable; do we need to preserve
// TODO: maybe buffer the config propose if there exists one (the way
// TODO: return an error?
// TODO(bdarnell): rethink RawNode initialization and whether the application needs
// TODO: make send async, more like real world...
// TODO: shall we dl without blocking the send call?
// TODO (xiangli): ensure the entries are continuous and
// TODO(bdarnell): what should this test?
// TODO(bdarnell): the peers argument is always nil except in
// TODO(bmizerany): optimize.. Currently naive
// TODO(xiangli) remove the panic when the raft implementation is stable
// TODO(xiangli) remove the panic when the raft implementation is stable
// TODO(xiangli) remove the panic when the raft implementation is stable
// TODO: learner may need to vote, in case of node down when confchange.
// TODO: return an error instead?
// TODO (xiangli): handle error?
// TODO qualify arm64
// TODO(yichengq): check this for joining through discovery service case
// TODO: do not hold the lock for long time?
// TODO: return error if ws is closed?
// TODO: add similar tests on operations in one txn/rev
// TODO: test attach key to lessor
// TODO: return the error instead of panic here?
// TODO: find a good buf value. 1024 is just a random one that
// TODO: make this non-blocking?
// TODO: k is an arbitrary constant. We need to figure out what factor
// TODO: disable v2 when deprecated.
// TODO: decouple tickMs and heartbeat tick (current heartbeat tick = 1).
// TODO: return err in v3.4
// TODO: return err in v3.4
// TODO: check whether fields are set instead of whether fields have default value
// TODO: support /etc/hosts ?
// TODO: add debug flag; enable logging when debug flag is set
// TODO: deprecate this in 3.4 release
// TODO: remove this resend logic when we add retry logic into the code
// TODO: return error or just panic?
// TODO: how to handle multiple client URLs?
// TODO: make sure this is a no leader response
// TODO(mitake): measure the cost of bcrypt.GenerateFromPassword()
// TODO(mitake): currently single role update invalidates every cache
// TODO(mitake): currently single role update invalidates every cache
// TODO(mitake): this function would be costly so we need a caching mechanism
//TODO(mitake|hexfusion) review unifying key names
// TODO: possible optimizations
// TODO: check kv hash before deactivating CORRUPT?
// TODO: consolidate **ALL** fake server implementations and add no leader test case.
// TODO: add no leader case
// TODO(jonboulle): check body as well as just status code
// TODO(jonboulle): define what parameters dir is/isn't compatible with?
// TODO: define clientv3/codes.Code.
// TODO: ensure only one of the field is set.
// TODO: combine progress and prevKV into a single struct?
// TODO: evs is []mvccpb.Event type
// TODO: move this out of the Store interface?
// TODO: very pricey; use a single store-wide watch in future
// TODO: use an actual member ID
// TODO: implement clientv3.Auth interface?
// TODO: remove manual parsing in etcdctl cluster-health
// TODO(jonboulle): clarify that these are IDs, not names
// TODO(jonboulle): appropriate error handling?
// TODO(jonboulle): use ID instead of name?
// TODO(jonboulle): appropriate error handling?
// TODO: maybe optimize backend.Size()
// TODO: fill out ResponseHeader
// TODO: a better const?
// TODO: limit request rate.
// TODO(philips): ensure these are URLs
// TODO: handle the case when "s.cluster.Members" have not
// TODO: fill out with most of the rest of RangeRequest fields when needed.
// TODO: int64 TTL = 2;
// TODO: TestNoSyncWhenNoLeader
// TODO: test server could stop itself when being removed
// TODO: remove kvindex != 0 checking when we do not expect users to upgrade
// TODO: move transport initialization near the definition of remote
// TODO: if this is an empty log, writes all peer infos
// TODO: add a state machine interface to apply the commit entries and do snapshot/recover
// TODO: remove the nil checking
// TODO: drain all requests, or drop all messages to the old leader
// TODO: move Member to protobuf type
// TODO: add Raft server interface to expose raft related info:
// TODO: non-blocking snapshot
// TODO: current store will never fail to do a snapshot
// TODO: return error to specify it happens because the cluster does not have leader now
// TODO: add ResponseHeaderTimeout back when watch on discovery service writes header early
// TODO(barakmich): Retrying the same node might want to succeed here
// TODO: detect not-last-snap error.
// TODO: maybe loose the checking of match.
// TODO: add MustMarshalTo to reduce one allocation.
// TODO(xiangli): no more reference operator
// TODO: split it into smaller tests for better readability
// TODO: secure by default when etcd enables secure gRPC by default.
// TODO: secure by default when etcd enables secure gRPC by default.
// TODO: support read limit
// TODO: support customized configuration
// todo: add back new members when we start to deprecate old snap file.
// TODO: remove the last but one member
// TODO: client should return descriptive error codes for internal errors
// TODO: client should return more descriptive error codes for internal errors
// TODO: remove connection write timeout by selecting on http response closeNotifier
// TODO: use customized clock to make this test go faster?
// TODO: fewer round trips by fetching more than one key
// TODO: fewer round trips by fetching more than one key
// TODO DOes this make sense? When is out a Ptr except when decoding a nil value?
// TODO This can easily be made faster and produce less garbage.
// TODO(tmc): allow modification of upgrader settings?
// TODO(tmc): consider customizability/extension point here.
// TODO(fabxc): Wrap this as a line reader to make streaming safer.
// TODO(beorn7): Remove this whole file. It is a partial mirror of
// TODO(beorn7): Consider streaming serving of metrics.
// TODO(beorn7): Code generation would help here.
// TODO(beorn7): Remove this hacky way to check for instance labels
// TODO(beorn7): Simplify switch once Desc has type.
// TODO(beorn7): Simplify switch once Desc has type.
// TODO(beorn7): For small numbers of buckets (<30), a linear search is
// TODO(beorn7): The original rationale of passing in a pre-allocated
// TODO(ts): Bring back error reporting by reverting 7faf9e7 as soon as the
// TODO: Implement this for the web. Detect east asian in a compatible way, and return true.
// TODO: Refactor code in conn.go to allow more direct construction of
// TODO: scan for next page
// TODO: reject pgidNoFreeList if !NoFreelistSync
// TODO(benbjohnson): Use vectorized I/O to write out dirty pages.
// TODO(benbjohnson): Optimize this range search. It's a bit hacky right now.
// TODO(benbjohnson): Optimize this range search. It's a bit hacky right now.
// todo: check if can get more uses of alloc=false
// TODO: Should we silently skip this instead?
// TODO: message sets.
// TODO: Check whether we need to handle
// TODO: Do something smarter than a linear scan.
// TODO: Handle nested messages which implement encoding.TextUnmarshaler.
// TODO: Check types, field numbers, etc.?
// TODO: Check types, field numbers, etc.?
// TODO: consider removing some of the Marshal functions below.
// TODO: Some day, make this a panic.
// TODO: Consider batching the allocations we do here.
// TODO: add Size to Marshaler, or add a Sizer interface.
// TODO: Reuse a Buffer.
// TODO: Reuse a Buffer.
// TODO: Reuse a Buffer.
// TODO: caching?
// TODO: return error instead?
// TODO: RawMessage.
// TODO: pass the correct Properties if needed.
// TODO: pass the correct Properties if needed.
// TODO: This won't work because the fields are unexported.
// TODO(beorn7): This tries to merge not only individual samples, but
// TODO(beorn7): How to calculate delta correctly?
// TODO(yugui) Support []byte
// TODO(yugui) Support []byte
// TODO(yugui) Support fields of primitive types in a message.
// TODO(yugui) Support fields of primitive types in a message.
// TODO(yugui) Should use proto.StructProperties?
// todo: check if can get more uses of alloc=false
// TODO: Should we silently skip this instead?
// TODO: message sets.
// TODO: Check whether we need to handle
// TODO: Do something smarter than a linear scan.
// TODO: Handle nested messages which implement encoding.TextUnmarshaler.
// TODO: Check types, field numbers, etc.?
// TODO: Check types, field numbers, etc.?
// TODO: consider removing some of the Marshal functions below.
// TODO: Some day, make this a panic.
// TODO: Consider batching the allocations we do here.
//TODO this is only copied, please fix this
//TODO this is only copied, please fix this
// TODO: add Size to Marshaler, or add a Sizer interface.
// TODO: Reuse a Buffer.
// TODO: Reuse a Buffer.
// TODO: Reuse a Buffer.
// TODO: caching?
// TODO: return error instead?
// TODO: RawMessage.
// TODO(kenton):  Base-64 encode?
//TODO: remove, unnecessary
// TODO: Top-level: ensure that v is a pointer and not nil.
// TODO: else drain if chan, clear if map, set all to nil if slice???
// TODO: else drain if chan, clear if map, set all to nil if slice???
// TODO: maybe ask to recognize ...
// TODO: consider recognize here
// TODO: may need to tweak this so it works.
// TODO: implement.
// TODO: expand this to handle canonical.
// TODO: consider a more generally-known optimization for reflect.Value ==> Interface
//TODO: support bincUnicodeOther (for now, just use string or bytearray)
// TODO: Consider perf implication of encoding odd index values as symbols if type is string
// TODO: Movable pointers will be an issue here. Future problem.
// TODO: calling isRecognizedRtid here is a major slowdown
// TODO: this is brittle, as it depends on z.go's init() being called last.
// TODO: REMOVE
// TODO: fieldName or encName? use encName for now.
// TODO: check when this is looking for ASCII alnum and when it should use unicode
// TODO: improve this regexp to catch all possible entities:
// TODO: handle unicode here
// TODO: this
// TODO: this
// TODO: convert this into a unicode character or something
// TODO(shurcooL): It's probably a good idea to simplify the 2 code paths here
// TODO: this isn't quite right, we should really check ahead for 'true' or 'false'
// TODO Fix uneven col size
// TODO Custom alignment per column
// TODO: replace `Action: interface{}` with `Action: ActionFunc` once some kind
// TODO: replace `Action: interface{}` with `Action: ActionFunc` once some kind
// TODO: pick a less arbitrary value? this is a bit under
// TODO: less copy-happy queue.
// TODO: Benchmark to determine if the pools are necessary. The GC may have
// TODO: adjust this writer size to account for frame size +
// TODO: SetMaxDynamicTableSize, SetMaxDynamicTableSizeLimit on
// TODO: do clients send GOAWAY too? maybe? Just Close:
// TODO(bradfitz): this is a copy of the logic in net/http. Unify somewhere?
// TODO(bradfitz): this Flush could potentially block (as
// TODO: write h12Compare test showing whether
// TODO(bradfitz): this flush is for latency, not bandwidth.
// TODO: also do this if we've written the headers but not
// TODO(bradfitz): move first response byte earlier,
// TODO: care? unlike http/1, it won't mess up our framing, so it's
// TODO: care? unlike http/1, it won't mess up our framing, so it's
// TODO: ConnectionError might be overly harsh? Check.
// TODO: be stricter here? only silently ignore things which
// TODO: check that any declared content-length matches, like
// TODO: deal with GOAWAY more. particularly the error code
// TODO(bradfitz): handle more settings? SETTINGS_HEADER_TABLE_SIZE probably.
// TODO: return error if server tries to RST_STEAM an idle stream
// TODO: map err to more interesting error codes, once the
// TODO: use singleflight for dialing and addConnCalls?
// TODO: maybe switch to RWMutex
// TODO: add support for sharing conns based on cert names
// TODO: don't close a cc if it was just added to the pool
// TODO: add method *Decoder.Reset(maxSize, emitFunc) to let callers re-use Decoders and their
// TODO: remove this method and make it incremental later? This is
// TODO: proper overflow check. making this up.
// TODO: decide whether to a) use this in the client code (which didn't
// TODO: this is a common one. It'd be nice to return true
// TODO: see writeResHeaders.staysWithinBuffer
// TODO: return an error? golang.org/issue/14048
// TODO: more of "8.1.2.2 Connection-Specific Header Fields"
// TODO: turn off the serve goroutine when idle, so
// TODO (maybe): add a mechanism for Handlers to going into
// TODO: make this 100 as the GFE seems to?
// TODO: implement
// TODO: optionally enforce? Or enforce at the time we receive
// TODO: remove this helper function once http2 can use build
// TODO: remove this string search and be more like the Windows
// TODO(bradfitz): x/tools/cmd/bundle doesn't really support
// TODO: configurable on *Server?
// TODO: configurable
// TODO: could we also get into this state if
// TODO: add CloseWrite to crypto/tls.Conn first
// TODO: send more details to the peer somehow. But http2 has
// TODO: adjust buffer writing sizes based on server config, frame size updates from peer, etc
// TODO(bradfitz): be faster here, like net/http? measure.
// TODO: send a RST_STREAM
// TODO: let getReadBuf be configurable, and use a less memory-pinning
// TODO: track which type of frame & with which flags was sent
// TODO: consider using strings.Trim(x, " \t") instead,
// TODO returns a non-nil, empty Context. Code should use context.TODO when
// TODO(jbd): Serve Traces from /debug/traces in the future?
// TODO(dsymonds): keep track of traced requests in separate buckets.
// TODO(dsymonds): Use sync.Pool?
// TODO: assert invariant
// TODO(sameer): move this loop under the family lock.
// TODO(sameer): change this to a ring buffer to avoid the array copy
// TODO(sameer): if this causes allocations on a critical path,
// TODO: the current error handling is, in my opinion, the least opinionated.
// TODO: profiles
// TODO: handle the NV8 defined in the Unicode idna data set to allow
// TODO: the punycode converters require strings as input.
// TODO: handle V2008
// TODO: merge the use of this in the trie.
// TODO: support and handle two-byte inline masks
// TODO: add more here, after collecting data on the common
// TODO(brainman): implement SockaddrUnix.sockaddr()
// TODO(brainman): fix all needed for net
// TODO(brainman): fix all needed for os
// TODO(mattn): SockaddrGen is union of sockaddr/sockaddr_in/sockaddr_in6_old.
// TODO(rsc): Rewrite all nn(SP) references into name+(nn-8)(FP)
// TODO(rsc): Can we use a single global basep for all calls?
// TODO(aram): implement this, see issue 5847.
// TODO(dfc): constants that should be in zsysnum_linux_arm64.go, remove
// TODO(aram): remove these before Go 1.3.
// TODO(rsc): Can we use a single global basep for all calls?
// TODO(jsing): DragonFly has a "bug" (see issue 3349), which should be
// TODO: wrap
// TODO: is this correct?
// TODO: using CompactClass would result in noticeable speedup.
// TODO: using CompactClass results in noticeable speedup.
// TODO: loosen these conditions.
// TODO: create the decomposition for Hangul?
// TODO: get rid of reorderBuffer. See CL 23460044.
// TODO: Using streamSafe to determine the boundary isn't the same as
// TODO: this could be removed if we don't support merging.
// TODO: inline.
// TODO: this condition should not be possible, but we leave it
// TODO: use sparse blocks. This would reduce table size considerably
// TODO: return an error.
// TODO: change validation to not panic
// TODO: using this for bidirule reduces the running time by about 5%. Consider
// TODO: find a better API and expose.
// TODO: these lookup methods are based on the generated trie code. The returned
// TODO: perhaps with options.
// TODO: methods for
// TODO: have separate type for "strong" directionality.
// TODO: use separate type for "strong" directionality.
// TODO: implement ReadByte (and ReadRune??).
// TODO: limit the amount copied on first try.
// TODO: make chain use Span (is going to be fun to implement!)
// TODO:  let transformers implement an optional Spanner interface, akin
// TODO(dsymonds): add stringifying info to codec, and limit how much we hold here?
// TODO(zhaoq): Define the set of the qualified keys instead of leaving
// TODO(bar) never return nil, nil when DNS becomes the default resolver.
// TODO(bar) return error when DNS becomes the default (implemented and
// TODO(bar switching) this should never be nil. Pickfirst should be default.
// TODO(bar switching) create balancer if it's nil?
// TODO(stevvooe): The following fields are not exported, as allowing
// TODO: More to be added.
// TODO(bar) remove this when switching balancer is done.
// TODO(bar) init balancer after first resolver result to support service config balancer.
// TODO(bar) there should always be a resolver (DNS as the default).
// TODO(bar) remove this after the real resolver is started.
// TODO: load balance policy runtime change is ignored.
// TODO(bar) Move this to the addrConn section.
// TODO: Avoid the locking here.
// TODO this function returns toRPCErr and non-toRPCErr. Clean up
// TODO(bar) make sure all state transitions are valid.
// TODO(bar) remove condition once we always have a balancer.
// TODO(zhaoq): Make this synchronous to avoid unbounded memory consumption in
// TODO: Remote this unused variable.
// TODO: See if we can replace StreamError with status package errors.
// TODO: return error instead, when callers are able to handle it.
// TODO: minimize garbage, optimize recvBuffer code/ownership
// TODO(zhaoq): Handle uint32 overflow of Stream.id.
// TODO(mmukhi): Benchmark if the perfomance gets better if count the metadata and other header fields
// TODO(mmukhi): Perhaps this field should be updated when actually writing out to the wire.
// TODO(bradfitz, zhaoq): A copy is required here because there is no
// TODO(zhaoq): currently one reader per transport. Investigate whether this is
// TODO(zhaoq): Check the validity of the incoming frame sequence.
// TODO(zhaoq): This is a hack to avoid significant refactoring of the
// TODO(mmukhi): A lot of this code(and code in other places in the tranpsort layer)
// TODO(zhaoq): It is the simplistic and not bandwidth efficient. Improve it.
// TODO(zhaoq): Have a better way to signal "no limit" because 0 is
// TODO: Handle GoAway from the client appropriately.
// TODO(bradfitz, zhaoq): A copy is required here because there is no
// TODO(mmukhi): Benchmark if the perfomance gets better if count the metadata and other header fields
// TODO(mmukhi): Revisit this later, if needed.
// TODO(zhaoq): Now it indicates the end of entire stream. Revisit if early
// TODO(mmukhi): Benchmark if the perfomance gets better if count the metadata and other header fields
// TODO: return error instead, when callers are able to handle it.
// TODO(mmukhi): A lot of this code(and code in other places in the tranpsort layer)
// TODO(zhaoq): Now the destruction is not blocked on any pending streams. This
// TODO(zhaoq): Probably revisit the error handling.
// TODO: The trace of the RPC is terminated here when there is no pending
// TODO Investigate how to signal the stats handling party.
// TODO: It is probably better to move this into the generated code.
// TODO: It is not clear how to construct and take advantage of the meaningful error
// TODO Note that in later releases, a ClientConn with no activity will be put into an Idle state.
// TODO(bar) install dns resolver in init(){}.
// TODO(bar) install pickfirst as default.
// TODO checkRecvPayload always return RPC error. Add a return here if necessary.
// TODO: Revisit the error code. Currently keep it consistent with
// TODO: Should we be logging if writing status failed here, like above?
// TODO: Should we log an error from WriteStatus here and below?
// TODO make a general purpose buffer that uses interface{}.
// TODO(bar) the state transition could be wrong when tearDown() old ac
// TODO(bradfitz,zhaoq): garbage. reuse buffer after proto decoding instead
// TODO truncate large payload.
// TODO: Revisit the error code. Currently keep it consistent with java
// TODO truncate large payload.
// TODO(zhaoq): Check whether the received message sequence is valid.
// TODO ctx is used for stats collection and processing. It is the context passed from the application.
// TODO in the current implementation, inTrailer may be handled before inPayload in some cases.
// TODO(dsymonds): Arrange for c.traceInfo.firstLine.remoteAddr to be set.
// TODO(zhaoq): Need a formal spec of fail-fast.
// TODO(zhaoq): Probably revisit the error handling.
// TODO: Is the same addr with different server name a different balancer?
// TODO: Revisit the handling here and may introduce some fallback mechanism.
// TODO: Revisit the handling here and may introduce some fallback mechanism.
// TODO: Fall back to the basic round-robin load balancing if the resulting address is
// TODO: backoff on retry?
// TODO: backoff on retry?
// TODO: Support delegation.
// TODO: Fall back to the basic direct connection if there is no name resolver.
// TODO: support different sorts of intervals: (a,b), [a,b], (a, b]
// TODO: recover from job panic?
// TODO: deprecate this in v4
// TODO: support server-side refresh (e.g. inotify, SIGHUP), caching
// TODO: verify the keepalive option is set correctly
// TODO: cache
// TODO: exit with error in v3.4
// TODO: improve this when we are able to know the schedule or status of target go-routine.
// TODO: support FALLOC_FL_ZERO_RANGE
// TODO: allocate contiguous space on disk with F_ALLOCATECONTIG flag
// TODO: deprecate this in v4
// TODO: TTL int64
// TODO do something with this error?
// TODO: remove this (expose client connection state?)
// TODO: decrease timeout when balancer switch rewrite
// TODO: add delete
// TODO wrap input client to generate errors
// TODO: test server-to-client keepalive ping
// TODO: only send healthy endpoint to gRPC so gRPC wont waste time to
// TODO: first operation can succeed
// TODO: add a client that can connect to all the members of cluster via unix sock.
// TODO: test handle more complicated failures.
// TODO: change this line to get a cluster client
// TODO: remove random sleep by syncing directly with balancer
// TODO: repeatableRetry if read-only txn
// TODO: wait on keys in comparisons
// TODO: support read-only Txn
// TODO: are permanent Internal errors possible from grpc?
// TODO: remove this when "FailFast=false" is fixed.
// TODO pause channel if buffer gets too large
// TODO: remove FailFast=false
// TODO: use clockwork for testability.
// TODO: probably this should be a heap with a secondary
// TODO: raft follower do not forward lease management proposals. There might be a
// TODO: when lessor is under high load, it should give out lease
// TODO: probably should change to <= 100-500 millisecond to
// TODO: copy vs and do decoding outside tx lock if lock contention becomes an issue.
// TODO: fill out ResponseHeader
// TODO: fill out ResponseHeader
// TODO: Batch request in future?
// TODO: remove /v3alpha tests in 3.4 release
// TODO: support non-interactive mode
// TODO: test with embedded etcd in integration package
// TODO(mitake): after printing accurate error message that includes
